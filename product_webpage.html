<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main_style.css">
    <!-- font Awesome -->
    <link rel="stylesheet" href="css/all.min.css" />
    <!-- <script type="module" src="js/app.js"></script> -->
    <script type="module" src="js/depart.js"></script>

</head>
<style>
    /*  */
    #registerModal {
        border-radius: 20px;
    }

    #loginModal {
        border-radius: 20px;
    }

    #reg_link a {
        color: #fff;
    }

    #reg_link a:hover {
        color: #f6b354;
    }

    .bg-modal {
        background-color: #424769;
    }

    .modal_register {
        background-color: #424769;
        height: 800px;
        border-start-start-radius: 20px;
        border-end-start-radius: 20px;
    }

    .modal_right_register {
        border-start-end-radius: 20px;
        border-end-end-radius: 20px;
    }

    .modal_left_login {
        background-color: #424769;
        height: 600px;
        border-start-start-radius: 20px;
        border-end-start-radius: 20px;
    }

    .modal_right_login {
        background-image: url(img/web/loginmodal_background.jpg);
        border-start-end-radius: 20px;
        border-end-end-radius: 20px;
    }

    #ok_btn_reg {
        background-color: #f6b354;
        width: 150px;
    }

    #ok_btn_login {
        background-color: #f6b354;
        width: 150px;
    }

    /*  */
    .btn-cart {
        position: relative;
        background-color: transparent;
    }

    .btn-cart:hover {
        cursor: pointer;
    }

    .btn-cart .badge {
        position: absolute;
        top: 0;
        right: 0;
    }

    .dropdown-menu-right {
        right: 0;
        left: auto;
    }

    /* è³¼ç‰©è»Š */
    .cart-sidebar {
        position: fixed;
        top: 0;
        right: 0;
        width: 100%;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.3);
        /* èƒŒæ™¯é®ç½© */
        z-index: 1055;
        display: flex;
        justify-content: flex-end;
        transition: opacity 0.3s ease;
        opacity: 0;
        pointer-events: none;
    }

    .cart-sidebar.active {
        opacity: 1;
        pointer-events: auto;
    }

    .cart-content {
        width: 30vw;
        /* ğŸ‘‰ é€™è£¡èª¿æ•´å¯¬åº¦ */
        max-width: 100%;
        background-color: #fff;
        height: 100%;
        transform: translateX(100%);
        transition: transform 0.4s ease-in-out;
        box-shadow: -4px 0 10px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
    }

    .cart-content .cart-body {
        flex-grow: 1;
        overflow-y: auto;
        min-height: 0;
    }

    .cart-sidebar.active .cart-content {
        transform: translateX(0);
    }

    /* è³¼ç‰©è»Š åƒåœ¾æ¡¶ hover å‹•ç•«æ•ˆæœ */
    .cart-trash-icon {
        transition: transform 0.3s ease;
        cursor: pointer;
    }

    .cart-trash-icon:hover {
        transform: scale(1.2) rotate(-15deg);
    }

    /* åˆªé™¤å‹•ç•«ï¼ˆæ·¡å‡º+å¾€å·¦ï¼‰ */
    .removing {
        animation: fadeOutLeft 0.4s forwards;
    }

    @keyframes fadeOutLeft {
        0% {
            opacity: 1;
            transform: translateX(0);
        }

        100% {
            opacity: 0;
            transform: translateX(-100px);
        }
    }
</style>

<body>
    <div id="web">
        <!-- navbar -->
        <section>
            <header>
                <nav class="navbar navbar-light bg-light navbar-expand-lg bg-body-tertiary fixed-top">
                    <div class="container-fluid">
                        <a class="navbar-brand ms-4" href="index.html">
                            <img src="img/web/logo_sm.png" alt="">
                        </a>
                        <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                            data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar"
                            aria-labelledby="offcanvasNavbarLabel">
                            <div class="offcanvas-header">
                                <h5 class="offcanvas-title" id="offcanvasNavbarLabel">å°è¦½åˆ—</h5>
                                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                                    aria-label="Close"></button>
                            </div>
                            <div class="offcanvas-body container-fluid justify-content-center" id="offcanvasNavbar">
                                <ul class="navbar-nav justify-content-end flex-grow-1 me-5 ">
                                    <li class="nav-item mt-2">
                                        <a class="nav-link active" aria-current="page" href="index.html">é¦–é </a>
                                    </li>
                                    <li class="nav-item mt-2">
                                        <a class="nav-link" href="#">æœ€æ–°æ¶ˆæ¯</a>
                                    </li>
                                    <li class="nav-item mt-2">
                                        <a class="nav-link" href="product_webpage.html">æœ€æ–°ç”¢å“</a>
                                    </li>
                                    <li class="nav-item mt-2">
                                        <a class="nav-link" href="#">é—œæ–¼æˆ‘å€‘</a>
                                    </li>
                                    <li id="manager_function" class="nav-item dropdown d-none mt-2">
                                        <a class="nav-link text-primary" href="#" role="button"
                                            data-bs-toggle="dropdown" aria-expanded="false">
                                            ç®¡ç†å“¡åŠŸèƒ½
                                        </a>
                                        <ul class="dropdown-menu text-center">
                                            <li><a class="dropdown-item" href="member_control_panel.html">æœƒå“¡ç®¡ç†</a></li>
                                            <li><a class="dropdown-item" href="product_C_panel.html">æ–°å¢å•†å“</a></li>
                                            <li><a class="dropdown-item" href="product_control_panel.html">ç”¢å“ç®¡ç†</a></li>
                                            <li>
                                                <hr class="dropdown-divider">
                                            </li>
                                            <li><a class="dropdown-item" href="#">æœªä¾†åŠŸèƒ½</a></li>
                                        </ul>
                                    </li>


                                    <li class="nav-item dropdown ">
                                        <a href="" class="nav-link" role="button" data-bs-toggle="dropdown">
                                            <span class="me-3 d-none" id="navbar_username_showtext">
                                                <img src="#" id="navbar_memberPhoto"
                                                    class="rounded rounded-circle bg-cover border border-4 border-white"
                                                    style="width: 50px; height: 50px;">
                                                <span class="h5" id="navbar_username_text">XX</span>
                                            </span>
                                        </a>
                                        <ul id="normal_member_function" class="dropdown-menu tetx-center">
                                            <li class="dropdown-item text-center"><a
                                                    href="member_info_panel.html">æœƒå“¡è³‡æ–™</a></li>
                                            <li class="dropdown-item text-center">
                                                <a href="order_history.html">è¨‚å–®æŸ¥è©¢</a>
                                            </li>
                                            <li>
                                                <hr class="dropdown-divider">
                                            </li>
                                            <li class="dropdown-item text-center">
                                                <button id="navbar_btn_logout" class="btn d-none" @click="logout">
                                                    <i class="fa-solid fa-door-open fa-beat-fade fa-xl"></i>
                                                </button>
                                            </li>
                                        </ul>
                                    </li>

                                    <li id="navbar_btn_login" class="nav-item mt-2">
                                        <a href="#logimModal" class="nav-link" data-bs-target="#loginModal"
                                            data-bs-toggle="modal" role="button">
                                            <i class="fa-solid fa-user fa-xl"></i>
                                        </a>
                                    </li>

                                    <li class="nav-item mt-2">
                                        <!-- è³¼ç‰©è»Šicon -->
                                        <button class="btn btn-cart" @click="toggleCartSidebar(true)">
                                            <i class="fa-solid fa-cart-shopping fa-xl"></i>
                                            <span class="badge badge-pill text-bg-danger">{{ cartTotalQty }}</span>
                                        </button>
                                        <!-- è³¼ç‰©è»Š -->
                                        <div :class="['cart-sidebar', { 'active': showCartSidebar }]"
                                            @click.self="toggleCartSidebar(false)">
                                            <div class="cart-content bg-white shadow-lg d-flex flex-column">
                                                <!-- æ¨™é¡Œåˆ— -->
                                                <div
                                                    class="d-flex justify-content-between align-items-center p-3 border-bottom">
                                                    <h5 class="mb-0">ğŸ›’ è³¼ç‰©è»Š</h5>
                                                    <button class="btn btn-sm btn-outline-secondary border-0"
                                                        @click="toggleCartSidebar(false)">âœ–</button>
                                                </div>

                                                <!-- å¯æ»¾å‹•çš„å•†å“æ¸…å–®å€ -->
                                                <div class="cart-body flex-grow-1 overflow-auto p-3">
                                                    <table class="table align-middle">
                                                        <thead>
                                                            <tr>
                                                                <th class="col-3">å•†å“åç¨±</th>
                                                                <th class="col-3">æ•¸é‡</th>
                                                                <th class="col-3">å°è¨ˆ</th>
                                                                <th class="col-1"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr v-for="(item, index) in cart" :key="item.Product_id"
                                                                :class="{'removing': removingIndex === index}"
                                                                class="align-middle">
                                                                <td>
                                                                    <div class="d-flex align-items-center gap-2">
                                                                        <img :src="'img/product/' + item.Photo"
                                                                            alt="å•†å“åœ–ç‰‡" class="rounded border"
                                                                            style="width: 60px; height: 60px; object-fit: cover;">
                                                                        <div>{{ item.Name }}</div>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <div class="input-group input-group-sm">
                                                                        <button class="btn btn-outline-secondary"
                                                                            @click.stop="decreaseCartQty(index)">ï¼</button>
                                                                        <input type="number"
                                                                            class="form-control text-center"
                                                                            v-model.number="item.quantity" @click.stop
                                                                            @blur="correctCartQty(index)" />
                                                                        <button class="btn btn-outline-secondary"
                                                                            @click.stop="increaseCartQty(index)">ï¼‹</button>
                                                                    </div>
                                                                </td>
                                                                <td>NT${{ item.quantity * item.Price }}</td>
                                                                <td>
                                                                    <a href="#" @click.prevent="removeFromCart(index)">
                                                                        <i
                                                                            class="fas fa-trash-alt text-secondary cart-trash-icon"></i>
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>

                                                <!-- åº•éƒ¨å›ºå®šå€å¡Š -->
                                                <div class="p-3 border-top">
                                                    <div class="text-end fw-bold mb-2">ç¸½è¨ˆï¼šNT${{ cartTotal }}</div>
                                                    <button class="btn btn-primary w-100" @click="checkout">çµå¸³</button>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <hr>
                </nav>
            </header>
        </section>
        <!-- Login -->
        <div class="modal modal-lg fade" id="loginModal" aria-hidden="true" aria-labelledby="loginModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-cover">
                    <div class="row justify-content-center">
                        <div class="col-6 w-50 modal_left_login text-white text-center">
                            <div class="align-content-center text-start p-4">
                                <h3 class="text-center mt-5">ç®¡ç†è€…ç™»å…¥</h3>
                                <label for="Modal-username-login" class="form-label"
                                    aria-placeholder="ä½¿ç”¨è€…å¸³è™Ÿ">Username</label>
                                <input type="text" id="username_login" placeholder="ä½¿ç”¨è€…å¸³è™Ÿ" class="form-control"
                                    v-model="loginForm.username" />
                                <label for="username-login-modal" class="form-label mt-2"
                                    aria-placeholder="ä½¿ç”¨è€…å¸³è™Ÿ">Password</label>
                                <input type="password" id="password_login" placeholder="ä½¿ç”¨è€…å¯†ç¢¼" class="form-control"
                                    v-model="loginForm.password" />
                                <div class="form-check mt-3">
                                    <input type="checkbox" id="Modal-keeplogin" class="form-check-input" />
                                    <label class="form-check-label" for="Modal-keeplogin">ä¿æŒç™»å…¥</label>
                                </div>
                            </div>
                            <div class="row justify-content-center mt-2">
                                <button id="ok_btn_login" class="btn btn-lg border-1" @click="login">ç™»å…¥</button>
                                <div class="hr-container">
                                    æˆ–
                                </div>
                                <div class="" width="200">
                                    <a href="#registerModal" class="btn btn-lg btn-primary text-white border-1"
                                        data-bs-target="#registerModal" data-bs-toggle="modal"
                                        data-bs-dismiss="modal">è¨»å†Šæˆç‚ºæœƒå“¡</a>
                                </div>

                            </div>

                        </div>
                        <div class="col-6 w-50 modal_right_login bg-cover text-end">
                            <button type="button" class="btn-close btn-close-white me-3 mt-3" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Register -->
        <div class="modal modal-lg fade" id="registerModal" aria-hidden="true" aria-labelledby="loginModal"
            tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="row flex-column align-items-end modal-content modal_register ">
                    <div class="col-1">
                        <button type="button" class="btn-close me-3 mt-3 btn-close-white text-end"
                            data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="row p-3 justify-content-center">
                        <!--  -->
                        <div class="col-md-6">
                            <!-- username -->
                            <div class="mt-4">
                                <label for="" class="form-label text-white">æœƒå“¡å¸³è™Ÿ</label>
                                <input type="text" class="form-control" placeholder="8-15å­—ï¼Œé ˆå«è‹±æ–‡å­—æ¯åŠæ•¸å­—" v-model="username"
                                    :class="{'is-valid' : flag_username, 'is-invalid' : !flag_username }">
                                <div class="valid-feedback">{{ username_validfeedback }}</div>
                                <div class="invalid-feedback">{{ username_invalidfeedback }}</div>
                            </div>
                            <!-- password -->
                            <div class="mt-4">
                                <label for="" class="form-label text-white">æœƒå“¡å¯†ç¢¼</label>
                                <input type="password" class="form-control" v-model="password"
                                    placeholder="8-15å­—å…ƒï¼Œé ˆå«å¤§å°å¯«å­—æ¯åŠæ•¸å­—"
                                    :class="{'is-valid' : flag_password, 'is-invalid' : !flag_password }">
                                <div class="valid-feedback">å¯†ç¢¼ç¬¦åˆè¦å®š</div>
                                <div class="invalid-feedback">å¯†ç¢¼ä¸ç¬¦åˆè¦å®š</div>
                            </div>
                            <!-- confirm passeord -->
                            <div class="mt-4">
                                <label for="" class="form-label text-white">ç¢ºèªå¯†ç¢¼</label>
                                <input type="password" class="form-control" v-model="re_password"
                                    :class="{'is-valid' : flag_repassword, 'is-invalid' : !flag_repassword }">
                                <div class="valid-feedback">å¯†ç¢¼ç›¸ç¬¦</div>
                                <div class="invalid-feedback">å¯†ç¢¼ä¸ç›¸ç¬¦</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <!-- å€‹äººç…§ -->
                            <div class="mt-4 shadow shadow-lg">
                                <label for="" class="form-label text-white">è«‹é¸æ“‡ä¸Šå‚³å€‹äººç…§:</label>
                                <input type="file" class="form-control" @change="handlePhotoUpload">
                                <div v-if="previewPhoto" class="mt-2 text-center">
                                    <img :src="previewPhoto" class="rounded-circle"
                                        style="width: 150px; height: 150px; object-fit: cover;" />
                                </div>
                            </div>
                        </div>
                        <!-- æœƒå“¡è³‡æ–™ -->
                        <div class="hr-container">
                            <h5 class="text-white text-center">æœƒå“¡è³‡æ–™</h5>
                        </div>
                        <div class="row">
                            <!-- å§“å -->
                            <div class="col-md-3">
                                <input type="text" placeholder="å¤§å" class="form-control" v-model="realname" />
                            </div>
                            <!-- æ€§åˆ¥ -->
                            <div class="col-md-3 pt-1">
                                <label for="" class="form-check-label text-white">ç”·</label>
                                <input type="radio" class="form-check-input form-check-inline" value="ç”·"
                                    v-model="gender">
                                <label for="" class="form-check-label text-white">å¥³</label>
                                <input type="radio" class="form-check-input form-check-inline" value="å¥³"
                                    v-model="gender">
                            </div>
                            <!-- ä¿¡ç®± -->
                            <div class="col-md-6">
                                <input type="text" class="form-control" v-model="email"
                                    :class="{'is-valid' : flag_email, 'is-invalid' : !flag_email }">
                                <div class="valid-feedback">ç¬¦åˆè¦å®š</div>
                                <div class="invalid-feedback">ä¸ç¬¦åˆè¦å®š</div>
                            </div>
                            <!-- å±…ä½åœ° -->
                            <label for="" id="city_reg_label" class="form-label text-white mt-2"
                                aria-placeholder="">å±…ä½åœ°</label>
                            <div class="col-md-6">
                                <select class="form-select my-2" v-model="city">
                                    <option value="" disabled>è«‹é¸æ“‡ç¸£å¸‚</option>
                                    <option v-for="c in cityOptions" :key="c.CityName" :value="c.CityName">{{
                                        c.CityName }}</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <select class="form-select my-2" v-model="district">
                                    <option value="">è«‹é¸æ“‡è¡Œæ”¿å€</option>
                                    <option v-for="d in districtOptions" :key="d.AreaName" :value="d.AreaName">{{
                                        d.AreaName }}</option>
                                </select>
                                <div class="invalid-feedback">è«‹å¡«å…¥å±…ä½åœ°</div>
                            </div>
                        </div>
                        <!-- è¨»å†ŠæŒ‰éˆ• -->
                        <button class="btn btn-lg border-1 mt-3" @click="register">è¨»å†Š</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å•†å“ Modal -->
        <div class="modal fade" id="productModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5 fw-900" id="staticBackdropLabel">{{ p_name }}</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        å•†å“å…§å®¹
                        <div class="text-center mb-3">
                            <img :src="'img/product/' + p_photo" class="img-fluid rounded" style="max-height: 300px;"
                                alt="å•†å“åœ–ç‰‡">
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <h4 class="text-primary">{{ p_name }}</h4>
                                <p class="text-muted">åƒ¹æ ¼ï¼šNT ${{ p_price }}</p>
                            </div>
                            <div class="col-6">
                                <div class="mb-3">
                                    <label class="form-label">æ•¸é‡</label>
                                    <div class="input-group" style="max-width: 200px;">
                                        <button class="btn btn-outline-secondary" type="button"
                                            @click="decreaseQuantity">ï¼</button>
                                        <input type="number" class="form-control text-center" v-model.number="quantity"
                                            :min="1" :max="p_stock" @blur="correctQuantity" />
                                        <button class="btn btn-outline-secondary" type="button"
                                            @click="increaseQuantity">ï¼‹</button>
                                    </div>
                                    <small class="text-danger" v-if="quantity > p_stock">âš  æ•¸é‡è¶…éåº«å­˜ (å‰© {{ p_stock }}
                                        ä»¶)</small>
                                </div>
                            </div>

                        </div>

                        <!-- <p>åº«å­˜æ•¸é‡ï¼š{{ p_stock }}</p> -->
                        <!-- <p v-if="p_status == 1" class="text-success">ç‹€æ…‹ï¼šä¸Šæ¶ä¸­</p>
                        <p v-else class="text-danger">ç‹€æ…‹ï¼šå·²ä¸‹æ¶</p> -->
                        <hr>
                        <p>{{ p_description }}</p>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
                        <button type="button" class="btn btn-primary" @click="addToCart">åŠ å…¥è³¼ç‰©è»Š</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- è¼ªæ’­ -->
        <section>
            <div class="container">
                <div class="row">
                    <div id="carousel"></div>
                </div>
            </div>
        </section>
        <!-- ç”¢å“è³‡æ–™ -->
        <section class="mt-5">
            <div class="container">
                <div class="row p-2">
                    <div class="col-md-1">
                        <aside class="text-center d-flex flex-column">
                            <h5>å•†å“åˆ†é¡</h5>
                            <a href="#" @click.prevent="selectedCategory = 'å…¨éƒ¨'"
                                :class="{'fw-bold text-warning': selectedCategory === 'å…¨éƒ¨'}"><small
                                    class="text-secondary">å…¨éƒ¨</small></a>
                            <a href="#" @click.prevent="selectedCategory = 'æœé£¾'"
                                :class="{'fw-bold text-warning': selectedCategory === 'æœé£¾'}"><small
                                    class="text-secondary">æœé£¾</small></a>
                            <a href="#" @click.prevent="selectedCategory = 'é‹å­'"
                                :class="{'fw-bold text-warning': selectedCategory === 'é‹å­'}"><small
                                    class="text-secondary">é‹å­</small></a>
                            <a href="#" @click.prevent="selectedCategory = 'é…ä»¶'"
                                :class="{'fw-bold text-warning': selectedCategory === 'é…ä»¶'}"><small
                                    class="text-secondary">é…ä»¶</small></a>
                            <a href="#" @click.prevent="selectedCategory = 'åŠé£¾'"
                                :class="{'fw-bold text-warning': selectedCategory === 'åŠé£¾'}"><small
                                    class="text-secondary">åŠé£¾</small></a>
                        </aside>
                    </div>
                    <div class="col-md-10 h-100 ms-3">
                        <div id="web_product" class="row justify-content-start">
                            <div class="col-md-3 m-4" v-for="item in filterProductforPage[currentPage]">
                                <div class="card border-light" style="width: 16em; height: 400px;">
                                    <img :src=" 'img/product/' + item.Photo " class="card-img-top"
                                        style="height: 300px;">
                                    <div class="card-body">
                                        <hr>
                                        <div class="me-5 d-flex">
                                            <div>
                                                <small>{{ item.Name }}</small>
                                                <div>
                                                    <span>NT: <span>{{ item.Price }}</span></span>
                                                </div>
                                            </div>
                                            <div class="ms-auto text-end">
                                                <button class="btn btn-danger" data-bs-target="#productModal"
                                                    data-bs-toggle="modal" data-id="{{ item.Product_id }}"
                                                    data-name="{{ item.Name }}" data-category="{{ item.Category }}"
                                                    data-description="{{ item.Description }}"
                                                    data-photo="{{ item.Photo }}" data-price="{{ item.Price }}"
                                                    data-status="{{ item.Status }}"
                                                    data-quanitity="{{ item.Stock_quantity }}"
                                                    @click="showdata(item)">è³¼è²·</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é æ•¸åˆ— -->
                <div class="row justify-content-center my-5">
                    <nav aria-label="...">
                        <ul class="pagination justify-content-center text-center">
                            <!-- ä¸Šä¸€é  -->
                            <li class="page-item" :class="{'disabled' : currentPage == 0}">
                                <a href="" class="page-link" @click.prevent="currentPage = currentPage -1">Previous</a>
                            </li>
                            <!-- ç›®å‰é æ•¸ -->
                            <li class="page-item" v-for="item in filterProductforPage.length">
                                <a href="#" class="page-link" :class="{'active' : item-1 == currentPage }" href="#"
                                    @click.prevent="currentPage = item-1">{{ item }}</a>
                            </li>
                            <!-- ä¸‹ä¸€é  -->
                            <li class="page-item" :class="{'disabled' : currentPage+1 == filterProductforPage.length }">
                                <a href="#" class="page-link" @click.prevent=" currentPage = currentPage+1">NEXT</a>
                            </li>
                        </ul>
                    </nav>
                </div>

            </div>
        </section>
        <!-- footer -->
        <div id="footer"></div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Vue CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- axios  -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>

    <script>
        const App = {
            data() {
                return {
                    // è¨»å†Šæœƒå“¡
                    username: '',
                    password: '',
                    re_password: '',
                    realname: '',
                    gender: '',
                    email: '',
                    city: '',
                    district: '',
                    cityOptions: [],
                    districtOptions: [],
                    photoFile: null,
                    previewPhoto: '',
                    flag_username: false,
                    flag_password: false,
                    flag_repassword: false,
                    flag_email: false,
                    username_validfeedback: '',
                    username_invalidfeedback: '',
                    // ç™»å…¥
                    loginForm: {
                        username: '',
                        password: '',
                    },
                    member: null,
                    isUsernameValid: true,
                    isPasswordValid: true,
                    // ç”¢å“æ¸²æŸ“
                    productList: [],
                    filterProductDataforPage: [],
                    productListforPage: [],
                    currentPage: 0,
                    //éæ¿¾ç¯©é¸ 
                    selectedCategory: 'å…¨éƒ¨',
                    // Modal è³‡æ–™æ¬„ä½
                    p_id: '',
                    p_name: '',
                    p_photo: '',
                    p_price: '',
                    p_description: '',
                    p_stock: '',
                    p_status: '',
                    quantity: 1, // åŠ å…¥è³¼ç‰©è»Šå•†å“æ•¸é‡
                    // è³¼ç‰©è»Šè¯é¡¯ç¤ºæ§åˆ¶
                    showCartSidebar: false,
                    removingIndex: null,
                    cart: [],
                }
            },
            created() {
                const vm = this;
                // æ¸²æŸ“ç”¢å“è³‡æ–™
                $.ajax({
                    type: 'GET',
                    url: 'api/product_control_api_v1.php?action=getdata',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        vm.productList = data.data;
                    },
                    error: vm.api_error
                });

                // è¼‰å…¥è³¼ç‰©è»Šè³‡æ–™
                const storedCart = localStorage.getItem('cart');
                if (storedCart) {
                    this.cart = JSON.parse(storedCart);
                }
            },
            watch: {
                city(newVal) {
                    const selected = this.cityOptions.find(c => c.CityName === newVal);
                    this.districtOptions = selected ? selected.AreaList : [];
                    this.district = '';
                },
                username: function (newValue) {
                    const vm = this;
                    // console.log(newValue);
                    // const rule = /[a-z]/; //è¦åŒ…å«è‹±æ–‡å­—æ¯
                    // const rule = /a/; //è¦åŒ…å«è‹±æ–‡å­—æ¯a
                    // const rule = /A/; //è¦åŒ…å«è‹±æ–‡å­—æ¯A
                    // const rule = /a./; //è¦åŒ…å«è‹±æ–‡å­—æ¯aä¸”ä¸å¯ä»¥åœ¨æœ€å¾Œ

                    // 1.è‡³å°‘8å€‹å­—å…ƒ
                    // 2.è¦æœ‰å¤§å°å¯«å­—æ¯
                    // 3.è‡³å°‘ä¸€å€‹æ•¸å­—
                    // 4.å°‘æ–¼15å€‹å­—å…ƒ
                    const rules = /^[a-zA-Z0-9]{6,15}$/;

                    // console.log(rules.test(newValue));
                    if (rules.test(newValue)) {
                        var JSONdata = {};
                        JSONdata["username"] = newValue;
                        // console.log(JSON.stringify(JSONdata));

                        // å‚³éè‡³å¾Œç«¯ç¢ºèªå“åæ˜¯å¦å¯ä»¥ä½¿ç”¨ (æ˜¯å¦é‡è¤‡)
                        $.ajax({
                            type: "POST",
                            url: "api/member_control_api_v1.php?action=checkuni",
                            dataType: "json",
                            data: JSON.stringify(JSONdata),
                            success: function (data) {
                                // console.log(data);
                                if (data.state) {
                                    vm.flag_username = true;
                                    vm.username_validfeedback = data.message;
                                } else {
                                    vm.flag_username = false;
                                    vm.username_invalidfeedback = data.message;
                                }
                            },
                            error: function () {
                                Swal.fire({
                                    title: "APIä»‹æ¥éŒ¯èª¤!",
                                    text: "member_login_control_v1.php?action=checkuni",
                                    icon: "error"
                                });
                            }
                        });

                    } else {
                        vm.flag_username = false;
                        vm.username_invalidfeedback = 'å¸³è™Ÿä¸ç¬¦åˆè¦å®š';
                    }
                },
                password: function (newValue) {
                    const vm = this;

                    // 1.è‡³å°‘8-15å€‹å­—å…ƒ
                    // 2.è¦æœ‰å¤§å°å¯«å­—æ¯
                    // 3.è‡³å°‘ä¸€å€‹æ•¸å­—
                    // 4.ç‰¹æ®Šç¬¦è™Ÿ
                    vm.flag_repassword = false;
                    const rules = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{6,15}$/;

                    // console.log(rules.test(newValue));
                    if (rules.test(newValue)) {
                        vm.flag_password = true;
                    } else {
                        vm.flag_password = false;
                    }
                },
                re_password: function (newValue) {
                    const vm = this;
                    if (vm.re_password == vm.password) {
                        vm.flag_repassword = true;
                    } else {
                        vm.flag_repassword = false;
                    }
                },
                email: function (newValue) {
                    const vm = this;
                    const rules = /^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;

                    if (rules.test(newValue)) {
                        vm.flag_email = true;
                    } else {
                        vm.flag_email = false;
                    }
                }
            },
            methods: {
                handlePhotoUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.photoFile = file;
                        this.previewPhoto = URL.createObjectURL(file);
                    }
                },
                async register() {
                    const vm = this;
                    if (vm.flag_username && vm.flag_password && vm.flag_repassword && vm.flag_email && vm.realname && vm.gender && vm.city && vm.district && vm.photoFile) {
                        //å‚³éè‡³å¾Œç«¯APIåŸ·è¡Œè¨»å†Šè¡Œç‚º

                        const formData = new FormData();
                        formData.append('photo', this.photoFile);

                        try {
                            const uploadRes = await axios.post('api/member_photoupload_api_v1.php', formData);
                            if (!uploadRes.data.state) {
                                return Swal.fire('åœ–ç‰‡ä¸Šå‚³å¤±æ•—', '', 'error');
                            }

                            const photoFilename = uploadRes.data.filename;
                            // const payload = {
                            //     username: this.username,
                            //     password: this.password,
                            //     email: this.email,
                            //     name: this.realName,
                            //     gender: this.gender,
                            //     city: this.city,
                            //     region: this.district,
                            //     photo: photoFilename
                            // };
                            var JSONdata = {};
                            JSONdata["username"] = vm.username;
                            JSONdata["password"] = vm.password;
                            JSONdata["photo"] = photoFilename;
                            JSONdata["name"] = vm.realname;
                            JSONdata["gender"] = vm.gender;
                            JSONdata["email"] = vm.email;
                            JSONdata["city"] = vm.city;
                            JSONdata["region"] = vm.district;
                            console.log(JSON.stringify(JSONdata));

                            const registerRes = await axios.post('api/member_control_api_v1.php?action=register', JSON.stringify(JSONdata));
                            const data = registerRes.data;
                            // Swal.fire(data.message, '', data.state ? 'success' : 'error');
                            if (data.state) {
                                // å„²å­˜ç™»å…¥è³‡è¨Š
                                localStorage.setItem('member', JSON.stringify(data.data));
                                vm.setCookie("UID01", data.data.UID01, 7);

                                // UI é¡¯ç¤ºç™»å…¥ç‹€æ…‹
                                document.getElementById("navbar_memberPhoto").src = "img/member/" + data.data.Photo;
                                document.getElementById("navbar_username_text").innerText = data.data.RealName;
                                $("#navbar_username_showtext").removeClass("d-none");
                                $("#navbar_btn_login").addClass("d-none");
                                $("#navbar_btn_logout").removeClass("d-none");

                                if (data.data.Role === "M") {
                                    $("#manager_function").removeClass("d-none");
                                }
                                $("#normal_member_function").removeClass("d-none");

                                Swal.fire(data.message, '', 'success');
                                bootstrap.Modal.getOrCreateInstance(document.getElementById('registerModal')).hide();
                                // bootstrap.Modal.getOrCreateInstance(document.getElementById('loginModal')).show();
                            } else {
                                Swal.fire(data.message, '', 'error');
                            }
                        } catch (err) {
                            Swal.fire('è¨»å†Šæµç¨‹ç™¼ç”ŸéŒ¯èª¤', '', 'error');
                        }
                    }

                },
                validateLoginForm() {
                    this.isUsernameValid = this.loginForm.username.length > 0;
                    this.isPasswordValid = this.loginForm.password.length > 0;
                    return this.isUsernameValid && this.isPasswordValid;
                },

                login() {
                    if (!this.validateLoginForm()) {
                        Swal.fire("è«‹ç¢ºèªå¸³è™Ÿèˆ‡å¯†ç¢¼æ˜¯å¦å¡«å¯«", '', 'warning');
                        return;
                    }

                    axios.post('api/member_control_api_v1.php?action=login', this.loginForm)
                        .then(res => {
                            const data = res.data;
                            if (data.state) {
                                Swal.fire({
                                    title: data.message,
                                    text: `${data.data.RealName} æ­¡è¿ç™»å…¥`,
                                    icon: 'success'
                                }).then(() => {
                                    this.setCookie("UID01", data.data.UID01, 7);
                                    // âœ… å¯«å…¥ localStorage
                                    localStorage.setItem('member', JSON.stringify(data.data));
                                    $("#loginModal").modal("hide");
                                    // é¡¯ç¤ºæœƒå“¡è³‡è¨Š
                                    document.getElementById("navbar_memberPhoto").src = "img/member/" + data.data.Photo;
                                    document.getElementById("navbar_username_text").innerText = data.data.RealName;
                                    $("#navbar_username_showtext").removeClass("d-none");
                                    $("#navbar_btn_login").addClass("d-none");
                                    $("#navbar_btn_logout").removeClass("d-none");

                                    if (data.data.Role === "M") {
                                        $("#manager_function").removeClass("d-none");
                                    }
                                    $("#normal_member_function").removeClass("d-none");
                                });
                            } else {
                                Swal.fire(data.message, '', 'error');
                            }
                        })
                        .catch(err => {
                            console.error(err);
                            Swal.fire("ç™»å…¥å¤±æ•—", "API éŒ¯èª¤", "error");
                        });
                },
                checkLogin() {
                    const uid = this.getCookie("UID01");
                    // å¾localStorageå–å¾—ç™»å…¥è³‡æ–™
                    const savedMember = localStorage.getItem('member');
                    if (savedMember) {
                        this.member = JSON.parse(savedMember);
                    }
                    if (!uid) return;

                    axios.post('api/member_control_api_v1.php?action=checkuid', {
                        uid01: uid
                    })
                        .then(res => {
                            const data = res.data;
                            if (data.state) {
                                this.member = data.data;
                                // é¡¯ç¤ºæœƒå“¡è³‡è¨Š
                                document.getElementById("navbar_memberPhoto").src = "img/member/" + data.data.Photo;
                                document.getElementById("navbar_username_text").innerText = data.data.RealName;
                                $("#navbar_username_showtext").removeClass("d-none");
                                $("#navbar_btn_login").addClass("d-none");
                                $("#navbar_btn_logout").removeClass("d-none");

                                if (data.data.Role === "M") {
                                    $("#manager_function").removeClass("d-none");
                                }
                                $("#normal_member_function").removeClass("d-none");
                            }
                        });
                },
                logout() {
                    Swal.fire({
                        title: "ç¢ºèªæ˜¯å¦è¦ç™»å‡º?",
                        icon: "warning",
                        showCancelButton: true,
                        confirmButtonText: "ç¢ºèª",
                        cancelButtonText: "å–æ¶ˆ"
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // åˆªé™¤ cookie
                            this.setCookie("UID01", "", -1);
                            this.member = null;
                            Swal.fire("æ‚¨å·²ç™»å‡º!", "", "success").then(() => {
                                location.href = "index.html";
                            });
                        }
                    });
                },
                setCookie(cname, cvalue, exdays) {
                    const d = new Date();
                    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                    document.cookie = `${cname}=${cvalue};expires=${d.toUTCString()};path=/`;
                },
                getCookie(cname) {
                    let name = cname + "=";
                    let ca = document.cookie.split(';');
                    for (let c of ca) {
                        while (c.charAt(0) == ' ') c = c.substring(1);
                        if (c.indexOf(name) == 0) return c.substring(name.length);
                    }
                    return "";
                },
                api_error() {
                    Swal.fire({
                        title: "APIä»‹æ¥éŒ¯èª¤!",
                        text: "member_control.api.v1.php",
                        icon: "error"
                    });
                },
                showdata(item) {
                    const vm = this;
                    vm.p_id = item.Product_id;
                    console.log(item);
                    vm.p_name = item.Name;
                    vm.p_photo = item.Photo;
                    vm.p_price = item.Price;
                    vm.p_description = item.Description;
                    vm.p_stock = item.Stock_quantity;
                    vm.p_status = item.Status;

                    // æ¯æ¬¡é–‹å•Ÿå•†å“è¦–çª—æ™‚é è¨­ç‚º 1
                    this.quantity = 1;
                },
                // å¢åŠ åŠ å…¥è³¼ç‰©è»Šå•†å“æ•¸é‡
                increaseQuantity() {
                    if (this.quantity < this.p_stock) {
                        this.quantity++;
                    }
                },
                // æ¸›å°‘åŠ å…¥è³¼ç‰©è»Šå•†å“æ•¸é‡
                decreaseQuantity() {
                    if (this.quantity > 1) {
                        this.quantity--;
                    }
                },
                correctQuantity() {
                    if (this.quantity < 1) this.quantity = 1;
                    if (this.quantity > this.p_stock) this.quantity = this.p_stock;
                },
                // åŠ å…¥è³¼ç‰©è»Š
                addToCart() {
                    if (this.quantity <= 0 || isNaN(this.quantity)) {
                        Swal.fire('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸é‡', '', 'warning');
                        return;
                    }

                    if (this.quantity > this.p_stock) {
                        Swal.fire('åº«å­˜ä¸è¶³', `æœ€å¤šå¯è³¼è²· ${this.p_stock} ä»¶`, 'warning');
                        return;
                    }

                    const existingItem = this.cart.find(item => item.Product_id === this.p_id);
                    if (existingItem) {
                        const totalQuantity = existingItem.quantity + this.quantity;
                        if (totalQuantity > this.p_stock) {
                            Swal.fire('åº«å­˜ä¸è¶³', `ç›®å‰å·²è³¼è²· ${existingItem.quantity} ä»¶ï¼Œæœ€å¤šé‚„èƒ½è³¼è²· ${this.p_stock - existingItem.quantity} ä»¶`, 'warning');
                            return;
                        }
                        existingItem.quantity += this.quantity;
                    } else {
                        this.cart.push({
                            Product_id: this.p_id,
                            Name: this.p_name,
                            Price: this.p_price,
                            Photo: this.p_photo,
                            quantity: this.quantity
                        });
                    }

                    localStorage.setItem('cart', JSON.stringify(this.cart));

                    Swal.fire({
                        icon: 'success',
                        title: 'å·²åŠ å…¥è³¼ç‰©è»Š',
                        text: `${this.p_name} Ã— ${this.quantity} ä»¶ å·²åŠ å…¥è³¼ç‰©è»Š`,
                        timer: 1000,
                        showConfirmButton: false
                    });

                    // é—œé–‰ Modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('productModal'));
                    if (modal) modal.hide();
                    // é‡è¨­æ•¸é‡
                    this.quantity = 1;
                },
                // æ§åˆ¶è³¼ç‰©è»Šå•†å“æ•¸é‡
                increaseCartQty(index) {
                    const item = this.cart[index];
                    // é€™è£¡ä½ å¯ä»¥ä¾å•†å“è³‡æ–™åŠ ä¸Šæœ€å¤§åº«å­˜é™åˆ¶ (å¯æ­é…å¾Œç«¯è£œé€²ä¾†)
                    item.quantity++;
                    this.saveCart();
                },

                decreaseCartQty(index) {
                    const item = this.cart[index];
                    if (item.quantity > 1) {
                        item.quantity--;
                        this.saveCart();
                    } else {
                        Swal.fire({
                            title: 'ç¢ºèªè¦å¾è³¼ç‰©è»Šç§»é™¤å—ï¼Ÿ',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'ç§»é™¤',
                            cancelButtonText: 'å–æ¶ˆ'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                this.removeFromCart(index);
                            }
                        });
                    }
                },

                correctCartQty(index) {
                    const item = this.cart[index];
                    if (item.quantity < 1 || isNaN(item.quantity)) {
                        item.quantity = 1;
                    }
                    this.saveCart();
                },

                saveCart() {
                    localStorage.setItem('cart', JSON.stringify(this.cart));
                },
                // åˆªé™¤å•†å“
                removeFromCart(index) {

                    Swal.fire({
                        icon: 'info',
                        title: 'ç§»é™¤å•†å“',
                        text: 'ç¢ºå®šè¦ç§»é™¤æ­¤å•†å“?'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            this.removingIndex = index; // åŠ å…¥å‹•ç•« class

                            // å»¶é²å¯¦éš›åˆªé™¤
                            setTimeout(() => {
                                this.cart.splice(index, 1);
                                localStorage.setItem('cart', JSON.stringify(this.cart));
                                this.removingIndex = null;
                            }, 400); // å‹•ç•«æ™‚é–“ä¸€è‡´
                        }
                    });

                },
                toggleCartSidebar(status) {
                    this.showCartSidebar = status;
                },
                // 
                checkout() {
                    const vm = this;
                    if (vm.cart.length === 0) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼',
                            text: 'è«‹å…ˆåŠ å…¥å•†å“å†çµå¸³'
                        });
                        return;
                    }

                    // æœƒå“¡ç™»å…¥æª¢æŸ¥
                    const member = JSON.parse(localStorage.getItem('member') || 'null');
                    if (!member) {
                        Swal.fire({
                            icon: 'info',
                            title: 'è«‹å…ˆç™»å…¥æœƒå“¡',
                            text: 'ç™»å…¥å¾Œæ‰èƒ½é€²è¡Œçµå¸³å–”ï½',
                            confirmButtonText: 'å‰å¾€ç™»å…¥'
                        }).then(() => {
                            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                            loginModal.show();
                        });
                        return;
                    }

                    // ç™¼é€è³¼ç‰©è»Šèˆ‡æœƒå“¡è³‡æ–™çµ¦å¾Œç«¯
                    // çµå¸³æµç¨‹ï¼ˆç™»å…¥è€…æ‰åŸ·è¡Œï¼‰
                    axios.post('api/order_api.php', {
                        cart: this.cart,
                        member_id: member.ID,
                        member_username: member.Username
                    }).then(res => {
                        Swal.fire({
                            icon: 'success',
                            title: 'è¨‚å–®å·²é€å‡ºï¼',
                            text: 'è¬è¬æ‚¨çš„è³¼è²·ï½'
                        });

                        this.cart = [];
                        localStorage.removeItem('cart');
                    }).catch(err => {
                        Swal.fire({
                            icon: 'error',
                            title: 'çµå¸³å¤±æ•—ï¼',
                            text: 'è«‹ç¨å¾Œå†è©¦'
                        });
                    });
                }

            },
            computed: {
                filterProductforPage() {
                    const filtered = this.selectedCategory === 'å…¨éƒ¨'
                        ? this.productList
                        : this.productList.filter(item => item.Category === this.selectedCategory);

                    // åˆ†é é‚è¼¯ï¼ˆæ¯ 9 ç­†ä¸€é ï¼‰
                    let newData = [];
                    filtered.forEach((item, index) => {
                        if (index % 9 === 0) {
                            newData.push([]);
                        }
                        const page = Math.floor(index / 9);
                        newData[page].push(item);
                    });
                    return newData;
                },
                // éæ¿¾ç¯©é¸
                filteredProducts() {
                    if (this.filterCategory === 'å…¨éƒ¨') return this.productList;
                    return this.productList.filter(p => p.Category === this.filterCategory);
                },
                cartTotalQty() {
                    return this.cart.reduce((sum, item) => sum + item.quantity, 0);
                },
                // è³¼ç‰©è»Šç¸½é‡‘é¡
                cartTotal() {
                    return this.cart.reduce((total, item) => total + item.quantity * item.Price, 0);
                }
            },
            mounted() {
                this.checkLogin();
                axios.get('js/CityCountyData.json')
                    .then(res => {
                        this.cityOptions = res.data;
                    })
                    .catch(() => {
                        Swal.fire('è¼‰å…¥ç¸£å¸‚è³‡æ–™å¤±æ•—', '', 'error');
                    });

            }
        }
        Vue.createApp(App).mount('#web');
    </script>
</body>

</html>